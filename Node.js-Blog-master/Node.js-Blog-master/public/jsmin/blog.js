function uploadFile(){var e=document.getElementById("file"),t=new FormData,n=null;return t.append("file",e.files[0]),$.ajax({url:"/upload",type:"POST",data:t,async:!1,cache:!1,contentType:!1,processData:!1,success:function(e){200===e.code?($("#result").html("上传成功！"),$("#img").attr("src","http://"+e.data.headersHost+"/images/"+e.data.name),$("#addimg").show(),n="/images/"+e.data.name):$("#result").html("上传失败！")},error:function(){$("#result").html("与服务器通信发生错误")}}),n}function insertAtCursor(e,t){if(document.selection)e.focus(),sel=document.selection.createRange(),sel.text=t,sel.select();else if(e.selectionStart||"0"==e.selectionStart){var n=e.selectionStart,a=e.selectionEnd;e.value=e.value.substring(0,n)+t+e.value.substring(a,e.value.length)}else e.value+=t}function iaddimg(){var e=document.getElementById("mytextarea"),t="![Alt text]("+uploadFile()+")";insertAtCursor(e,t)}window.onload=function(){if(!document.getElementById("upload"))return!1;var e=document.getElementById("upload");if(e.addEventListener("click",function(){uploadFile()},!1),!document.getElementById("addimg"))return!1;var t=document.getElementById("addimg");t.addEventListener("click",function(){iaddimg()},!1)};